name: Autograding Tests
on:
  push:
  repository_dispatch:
    types: [classroom_submit]
permissions:
  checks: write
  actions: read
  contents: read

jobs:
  run-autograding-tests:
    name: ÐžÑ†ÐµÐ½Ð¸Ð²Ð°Ð½Ð¸Ðµ Ð·Ð°Ð´Ð°Ð½Ð¸Ð¹
    runs-on: ubuntu-latest
    if: github.actor != 'github-classroom[bot]'
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: "[TASK 01] Run tests"
        id: task_01
        run: python3 tools/run_task_tests.py task_01

      - name: "[TASK 02] Run tests"
        id: task_02
        run: python3 tools/run_task_tests.py task_02

      - name: "[TASK 03] Run tests"
        id: task_03
        run: python3 tools/run_task_tests.py task_03

      - name: "[TASK 04] Run tests"
        id: task_04
        run: python3 tools/run_task_tests.py task_04

      - name: "[TASK 05] Run tests"
        id: task_05
        run: python3 tools/run_task_tests.py task_05

      - name: "[TASK 06] Run tests"
        id: task_06
        run: python3 tools/run_task_tests.py task_06

      - name: "[TASK 07] Run tests"
        id: task_07
        run: python3 tools/run_task_tests.py task_07

      - name: "[TASK 08] Run tests"
        id: task_08
        run: python3 tools/run_task_tests.py task_08

      - name: "[TASK 09] Run tests"
        id: task_09
        run: python3 tools/run_task_tests.py task_09

      - name: "[TASK 10] Run tests"
        id: task_10
        run: python3 tools/run_task_tests.py task_10

      - name: "[TASK 11] Run tests"
        id: task_11
        run: python3 tools/run_task_tests.py task_11

      - name: "[TASK 12] Run tests"
        id: task_12
        run: python3 tools/run_task_tests.py task_12

      - name: âœ… Generate Final Summary
        env:
          TASK_01_RESULT: ${{ steps.task_01.outputs.result }}
          TASK_02_RESULT: ${{ steps.task_02.outputs.result }}
          TASK_03_RESULT: ${{ steps.task_03.outputs.result }}
          TASK_04_RESULT: ${{ steps.task_04.outputs.result }}
          TASK_05_RESULT: ${{ steps.task_05.outputs.result }}
          TASK_06_RESULT: ${{ steps.task_06.outputs.result }}
          TASK_07_RESULT: ${{ steps.task_07.outputs.result }}
          TASK_08_RESULT: ${{ steps.task_08.outputs.result }}
          TASK_09_RESULT: ${{ steps.task_09.outputs.result }}
          TASK_10_RESULT: ${{ steps.task_10.outputs.result }}
          TASK_11_RESULT: ${{ steps.task_11.outputs.result }}
          TASK_12_RESULT: ${{ steps.task_12.outputs.result }}
        run: python3 tools/generate_summary.py task_01 task_02 task_03 task_04 task_05 task_06 task_07 task_08 task_09 task_10 task_11 task_12

      # ÐžÑ‚Ð¿Ñ€Ð°Ð²ÐºÐ° Ð² Classroom â€” Ð² ÑÑ‚Ð¾Ð¼ Ð¶Ðµ job'Ðµ!
      - name: ðŸ“¤ Report to GitHub Classroom
        uses: classroom-resources/autograding-grading-reporter@v1
        env:
          TASK_01_RESULTS: ${{ steps.task_01.outputs.result }}
          TASK_02_RESULTS: ${{ steps.task_02.outputs.result }}
          TASK_03_RESULTS: ${{ steps.task_03.outputs.result }}
          TASK_04_RESULTS: ${{ steps.task_04.outputs.result }}
          TASK_05_RESULTS: ${{ steps.task_05.outputs.result }}
          TASK_06_RESULTS: ${{ steps.task_06.outputs.result }}
          TASK_07_RESULTS: ${{ steps.task_07.outputs.result }}
          TASK_08_RESULTS: ${{ steps.task_08.outputs.result }}
          TASK_09_RESULTS: ${{ steps.task_09.outputs.result }}
          TASK_10_RESULTS: ${{ steps.task_10.outputs.result }}
          TASK_11_RESULTS: ${{ steps.task_11.outputs.result }}
          TASK_12_RESULTS: ${{ steps.task_12.outputs.result }}
        with:
          runners: task_01,task_02,task_03,task_04,task_05,task_06,task_07,task_08,task_09,task_10,task_11,task_12

  # JOB 2: Ð›Ð˜ÐÐ¢Ð•Ð Ð«
  code-quality-analysis:
    name: ÐÐ½Ð°Ð»Ð¸Ð· ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð° ÐºÐ¾Ð´Ð°
    runs-on: ubuntu-latest
    if: always()
    steps:
      - uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"
      - name: Install linters
        run: pip install pylint flake8 ruff -q
      - name: Run code analysis
        run: python3 tools/code_analysis.py >> $GITHUB_STEP_SUMMARY
